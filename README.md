## ëª©ì°¨

- [ëª©ì°¨](#ëª©ì°¨)
- [í”„ë¡œì íŠ¸ ì†Œê°œ](#í”„ë¡œì íŠ¸-ì†Œê°œ)
- [ERD ë‹¤ì´ì–´ê·¸ë¨](#erd-ë‹¤ì´ì–´ê·¸ë¨)
- [ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨](#ì‹œí€€ìŠ¤-ë‹¤ì´ì–´ê·¸ë¨)
  - [ì±„íŒ…ë°© ì…ì¥ í”„ë¡œì„¸ìŠ¤](#ì±„íŒ…ë°©-ì…ì¥-í”„ë¡œì„¸ìŠ¤)
  - [ì±—ë´‡ ì§ˆë¬¸ì— ëŒ€í•œ ì‚¬ìš©ì ì‘ë‹µ í”„ë¡œì„¸ìŠ¤](#ì±—ë´‡-ì§ˆë¬¸ì—-ëŒ€í•œ-ì‚¬ìš©ì-ì‘ë‹µ-í”„ë¡œì„¸ìŠ¤)
  - [ì±—ë´‡ ì§ˆë¬¸ì— ëŒ€í•œ ì‚¬ìš©ì ì‘ë‹µë©”ì‹œì§€ ì •ì±…ìœ„ë°˜ í”„ë¡œì„¸ìŠ¤](#ì±—ë´‡-ì§ˆë¬¸ì—-ëŒ€í•œ-ì‚¬ìš©ì-ì‘ë‹µë©”ì‹œì§€-ì •ì±…ìœ„ë°˜-í”„ë¡œì„¸ìŠ¤)
  - [ì±—ë´‡ì˜ ë§ˆì§€ë§‰í¸ì§€](#ì±—ë´‡ì˜-ë§ˆì§€ë§‰í¸ì§€)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
  - [ì „ì²´ í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì¡°](#ì „ì²´-í”„ë¡œì íŠ¸-íŒŒì¼-êµ¬ì¡°)
- [REST API ì •ì˜ì„œ](#rest-api-ì •ì˜ì„œ)
  - [ì±—ë´‡ëª©ë¡ ì¡°íšŒ](#ì±—ë´‡ëª©ë¡-ì¡°íšŒ)
  - [ì±—ë´‡ ë§ˆì§€ë§‰ í¸ì§€ ì¡°íšŒ](#ì±—ë´‡-ë§ˆì§€ë§‰-í¸ì§€-ì¡°íšŒ)
- [Websocket ì´ë²¤íŠ¸ ì •ì˜ì„œ](#websocket-ì´ë²¤íŠ¸-ì •ì˜ì„œ)
  - [`join_room` ì´ë²¤íŠ¸](#join_room-ì´ë²¤íŠ¸)
  - [`answer` ì´ë²¤íŠ¸](#answer-ì´ë²¤íŠ¸)
  - [`quiz` ì´ë²¤íŠ¸](#quiz-ì´ë²¤íŠ¸)
  - [`policy_error` ì´ë²¤íŠ¸](#policy_error-ì´ë²¤íŠ¸)
- [í”„ë¡œì íŠ¸ ì…‹íŒ… ë°©ë²•](#í”„ë¡œì íŠ¸-ì…‹íŒ…-ë°©ë²•)
  - [í”„ë¡œì íŠ¸ ì´ˆê¸° ì…‹íŒ…](#í”„ë¡œì íŠ¸-ì´ˆê¸°-ì…‹íŒ…)
  - [í”„ë¡œì íŠ¸ ì‹¤í–‰](#í”„ë¡œì íŠ¸-ì‹¤í–‰)
  - [ë‹¨ìœ„í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰](#ë‹¨ìœ„í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤-ì‹¤í–‰)

---

## í”„ë¡œì íŠ¸ ì†Œê°œ

![na-t-na-intro](./docs/na-t-na-intro.png)

Tì™€ F ì‚¬ì´ì—”, ê±°ë¦¬ê°€ ìˆë‹¤...? ğŸ“ ë‚˜ Të‚˜?? team

ë§ì€ ì´í•´í•˜ëŠ”ë°, ê°ì •ì€... ì˜ ëª¨ë¥´ê² ì„ ë•Œ, "ì´ëŸ´ ë• ë­ë¼ê³  ë§í•´ì•¼ ë¼?"ë¼ëŠ” ì§ˆë¬¸ì„ í•´ë³¸ ì  ìˆë‹¤ë©´, ì—¬ëŸ¬ë¶„ì€ ì´ë¯¸ ìš°ë¦¬ì˜ íƒ€ê²Ÿì…ë‹ˆë‹¤.

**`Fì™€ì˜ ê±°ë¦¬ëŠ”`** T ì„±í–¥ì„ ê°€ì§„ ì‚¬ëŒë“¤ì„ ìœ„í•œ ê°ì • ê³µê° ì‹œë®¬ë ˆì´ì…˜ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. F ìºë¦­í„°ë“¤ê³¼ì˜ ëŒ€í™”ë¥¼ í†µí•´ ë‚´ ê³µê°ê±°ë¦¬ë¥¼ ì§ì ‘ í™•ì¸í•´ë³´ì„¸ìš”!


- [ğŸ“ Fì™€ì˜ ì‚¬ì´ê±°ë¦¬ - ì„œë¹„ìŠ¤ ì†Œê°œì„œ ](https://www.figma.com/deck/SD6UF09n5KP2CCGeGRwzgb/F%EC%99%80%EC%9D%98-%EA%B1%B0%EB%A6%AC---%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%86%8C%EA%B0%9C%EC%84%9C?kind=deck&node-id=1-4682) ì—ì„œ ìì„¸íˆ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

<br>

> í”„ë¡œì íŠ¸ ì „ì²´ ì„œë¹„ìŠ¤ ì•„í‚¤í…ì³

<img width="2000" height="1000" alt="image" src="https://github.com/user-attachments/assets/938b1b90-fc2b-4083-b926-2494245bbbc1" />


<br>

<br>

> í”„ë¡œì íŠ¸ ì‹œì—°ì˜ìƒ

<https://github.com/user-attachments/assets/d3375fd6-f3cd-4e8f-a110-ff36fb10ef76>

<br>

> ë°±ì—”ë“œ íŒŒíŠ¸ ì‚¬ìš© ê¸°ìˆ ìŠ¤íƒ

- Language / Framework / Package-Manager: ![TypeScript](https://img.shields.io/badge/typescript-%23007ACC.svg?style=for-the-badge&logo=typescript&logoColor=white) ![NestJS](https://img.shields.io/badge/nestjs-%23E0234E.svg?style=for-the-badge&logo=nestjs&logoColor=white) ![Yarn](https://img.shields.io/badge/yarn-%232C8EBB.svg?style=for-the-badge&logo=yarn&logoColor=white)
- Web Socket: ![Socket.io](https://img.shields.io/badge/Socket.io-black?style=for-the-badge&logo=socket.io&badgeColor=010101)
- Testing: ![Jest](https://img.shields.io/badge/-jest-%23C21325?style=for-the-badge&logo=jest&logoColor=white)
- RDBMS / NoSQL: ![MySQL](https://img.shields.io/badge/mysql-4479A1.svg?style=for-the-badge&logo=mysql&logoColor=white) ![Redis](https://img.shields.io/badge/redis-%23DD0031.svg?style=for-the-badge&logo=redis&logoColor=white)
- Cloud: ![AWS](https://img.shields.io/badge/AWS-%23FF9900.svg?style=for-the-badge&logo=amazon-aws&logoColor=white)
- EC2, ALB(Application Load Balancer), Route53, ACM, S3, VPC
- CI/CD: ![GitHub Actions](https://img.shields.io/badge/github%20actions-%232671E5.svg?style=for-the-badge&logo=githubactions&logoColor=white) ![PM2](https://img.shields.io/badge/PM2-%232B037A?style=for-the-badge&logo=PM2&logoColor=white)


---

## ERD ë‹¤ì´ì–´ê·¸ë¨

![domain-relations](./docs/domain-relations.png)

- [dbdiagram link - Na-T-Na ERD](https://dbdiagram.io/d/na-T-na-BE-ERD-688b84b6cca18e685caf46b2)

![na-t-na-erd](./docs/na-T-na-BE-ERD.png)

<br>

---

## ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

### ì±„íŒ…ë°© ì…ì¥ í”„ë¡œì„¸ìŠ¤

![sequence-join-room](./docs/sequence-join-room.png)

<br><br>

### ì±—ë´‡ ì§ˆë¬¸ì— ëŒ€í•œ ì‚¬ìš©ì ì‘ë‹µ í”„ë¡œì„¸ìŠ¤

> ì²«ë²ˆì§¸ ì§ˆë¬¸(quiz)ì— ëŒ€í•œ ì‚¬ìš©ì ë‹µë³€ê³¼ ì±—ë´‡ ë¦¬ì•¡ì…˜ ì§„í–‰ í”„ë¡œì„¸ìŠ¤

![sequence-conversation-01](./docs/sequence-conversation-01.png)

<br>

> ë§ˆì§€ë§‰ ì§ˆë¬¸(5ë²ˆì§¸ ì§ˆë¬¸)ì— ëŒ€í•œ ì‚¬ìš©ì ë‹µë³€ê³¼ ì±—ë´‡ ë¦¬ì•¡ì…˜ ì§„í–‰ í”„ë¡œì„¸ìŠ¤

![sequence-conversation-02](./docs/sequence-conversation-02.png)

<br><br>

### ì±—ë´‡ ì§ˆë¬¸ì— ëŒ€í•œ ì‚¬ìš©ì ì‘ë‹µë©”ì‹œì§€ ì •ì±…ìœ„ë°˜ í”„ë¡œì„¸ìŠ¤

> ì‚¬ìš©ìì˜ ë‹µë³€ì—ì„œ ë¶€ì ì ˆí•œ íŠ¹ì • í‚¤ì›Œë“œ(ì˜ˆ: 'ìì‚´', 'í…ŒëŸ¬', 'ìš°ìš¸' ë“±) ê°€ í¬í•¨í•œ ê²½ìš°

![sequence-invalid-01](./docs/sequence-invalid-01.png)

> ì‚¬ìš©ìì˜ ë‹µë³€ì—ì„œ ë¹„ì†ì–´, ìš•ì„¤ ê³¼ ê°™ì€ ë¶ˆì¾Œê° ìœ ë°œ ë° ë¶€ì ì ˆí•œ ë¬¸ë§¥íë¦„ ê°ì§€í•˜ê±°ë‚˜ í”„ë¡¬í”„íŠ¸ íƒˆì·¨ í•  ê²½ìš°

![sequence-invalid-02](./docs/sequence-invalid-02.png)

<br><br>

### ì±—ë´‡ì˜ ë§ˆì§€ë§‰í¸ì§€

> ì±„íŒ… ì¢…ë£Œ í›„, ì±—ë´‡ì˜ ë§ˆì§€ë§‰í¸ì§€ë¥¼ ìš”ì²­í•´ì•¼í•˜ëŠ” ê²½ìš° (`is_finished = false`)

![sequence-feedback-01.png](./docs/sequence-feedback-01.png)

<br>

> ì´ë¯¸ ì±—ë´‡ì˜ ë§ˆì§€ë§‰í¸ì§€ë¥¼ ë°›ì€ ê²½ìš° (`is_finished = true` )

![sequence-feedback-02.png](./docs/sequence-feedback-02.png)

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

- 7ê°œì˜ ë„ë©”ì¸ì„ ì£¼ì¶•ìœ¼ë¡œ ëª¨ë“ˆìƒì„±
  ë¹„ì¦ˆë‹ˆìŠ¤ë¥¼ ì´ë£¨ëŠ” ë„ë©”ì¸ì€ `Chatbot`, `Chatroom`, `Message`, `Quiz`,`Quiz`, `User` ìœ¼ë¡œ ê° 6ê°œëŠ” ë…ë¦½ì ì¸ ëª¨ë“ˆê³¼ í”„ë¡œë°”ì´ë”ë¡œ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤.

- í´ë¦°ì•„í‚¤í…ì³ì™€ ë ˆì´ì–´ë“œì•„í‚¤í…ì³ì„ ëª¨ë¸ë¡œ í”„ë¡œì íŠ¸ì˜ ê° ë„ë©”ì¸ë³„ ê³„ì¸µì„ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.
- ê° ë„ë©”ì¸ì—ëŠ” `domain`, `presentation`, `infrastructure` 3ê°œì˜ ê³„ì¸µì„ ê°–ê³ ìˆìŠµë‹ˆë‹¤.
  - `domain`
    - í•´ë‹¹ ë„ë©”ì¸ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ë£°ê³¼ í•µì‹¬ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
    - ì„œë¹„ìŠ¤ë¡œì§, ë¹„ì¦ˆë‹ˆìŠ¤ê·œì¹™, ë˜í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤, ì„œë¹„ìŠ¤ unit-test ë¡œ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤.
  - `presentation`
    - ì»¨íŠ¸ë¡¤ëŸ¬(REST API), ê²Œì´íŠ¸ì›¨ì´(Web-Socket) ë“± ì— í•´ë‹¹ë˜ë©°, APIìš”ì²­í• ë•Œ ë¨¼ì € ì ‘ê·¼ë˜ëŠ” í”„ë ˆì  í…Œì´ì…˜ ë° ì´ë²¤íŠ¸/URL ë¼ìš°íŒ… ê³„ì¸µì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
  - `infrastructure`
    - ë„ë©”ì¸ê³„ì¸µì—ì„œëŠ” ë˜í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ì´ë©°, ì¸í„°í˜ì´ìŠ¤ì˜ ì‹¤ì œ êµ¬í˜„ì²´ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°ëœ ORMì„ ì´ìš©í•˜ì—¬ queryì— ì•Œë§ëŠ” ë¦¬ìŠ¤í°ìŠ¤ë¥¼ ì‘ë‹µí•©ë‹ˆë‹¤.

```bash
chatbots
â”œâ”€Â chatbots.module.ts
â”œâ”€Â domain
â”‚Â Â â”œâ”€Â chatbot-with-personalities.type.ts
â”‚Â Â â”œâ”€Â chatbot.policy.ts
â”‚Â Â â”œâ”€Â chatbot.repository.interface.ts
â”‚Â Â â”œâ”€Â chatbots.service.test.ts
â”‚Â Â â””â”€Â chatbots.service.ts
â”œâ”€Â infrastructure
â”‚Â Â â””â”€Â chatbot.repository.ts
â””â”€Â presentation
 Â Â â”œâ”€Â chatbots.controller.ts
Â Â Â â””â”€Â dto
Â Â Â Â Â Â Â Â â””â”€Â get-chatbots.response.dto.ts
```

### ì „ì²´ í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì¡°

```bash
ğŸ“¦
â”œâ”€Â .dockerignore
â”œâ”€Â .env.test
â”œâ”€Â .github
â”‚Â Â â””â”€Â workflows
â”‚Â Â Â Â Â â”œâ”€Â deploy-production.yml
â”‚Â Â Â Â Â â””â”€Â test.yml
â”œâ”€Â .gitignore
â”œâ”€Â .prettierrc
â”œâ”€Â .vscode
â”‚Â Â â””â”€Â launch.json
â”œâ”€Â Dockerfile
â”œâ”€Â README.md
â”œâ”€Â docker-compose.yml
â”œâ”€Â eslint.config.mjs
â”œâ”€Â jest.config.json
â”œâ”€Â nest-cli.json
â”œâ”€Â package.json
â”œâ”€Â prisma
â”‚Â Â â”œâ”€Â first-chatbot-seeds.ts
â”‚Â Â â””â”€Â schema.prisma
â”œâ”€Â src
â”‚Â Â â”œâ”€Â app.controller.spec.ts
â”‚Â Â â”œâ”€Â app.controller.ts
â”‚Â Â â”œâ”€Â app.module.ts
â”‚Â Â â”œâ”€Â app.service.ts
â”‚Â Â â”‚
â”‚Â Â â”œâ”€Â chatbots
â”‚Â Â â”‚Â Â â”œâ”€Â chatbots.module.ts
â”‚Â Â â”‚Â Â â”œâ”€Â domain
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â chatbot-with-personalities.type.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â chatbot.policy.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â chatbot.repository.interface.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â chatbots.service.test.ts
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â chatbots.service.ts
â”‚Â Â â”‚Â Â â”œâ”€Â infrastructure
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â chatbot.repository.ts
â”‚Â Â â”‚Â Â â””â”€Â presentation
â”‚Â Â â”‚Â Â Â Â Â â”œâ”€Â chatbots.controller.ts
â”‚Â Â â”‚Â Â Â Â Â â””â”€Â dto
â”‚Â Â â”‚Â Â Â Â Â Â Â Â â””â”€Â get-chatbots.response.dto.ts
â”‚Â Â â”‚
â”‚Â Â â”œâ”€Â chatrooms
â”‚Â Â â”‚Â Â â”œâ”€Â chatrooms.module.ts
â”‚Â Â â”‚Â Â â”œâ”€Â domain
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â chatroom-feedback-buisness-rule.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â chatroom.repository.interface.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â chatrooms.service.spec.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â chatrooms.service.ts
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â chatting-socket-business-rule.ts
â”‚Â Â â”‚Â Â â”œâ”€Â infrastructure
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â chatroom.repository.ts
â”‚Â Â â”‚Â Â â””â”€Â presentation
â”‚Â Â â”‚Â Â Â Â Â â”œâ”€Â chatrooms.controller.ts
â”‚Â Â â”‚Â Â Â Â Â â”œâ”€Â chatrooms.gateway.ts
â”‚Â Â â”‚Â Â Â Â Â â””â”€Â dto
â”‚Â Â â”‚Â Â Â Â Â Â Â Â â”œâ”€Â answer.dto.ts
â”‚Â Â â”‚Â Â Â Â Â Â Â Â â”œâ”€Â get-last-letter.dto.ts
â”‚Â Â â”‚Â Â Â Â Â Â Â Â â””â”€Â join-room.dto.ts
â”‚Â Â â”‚
â”‚Â Â â”œâ”€Â common
â”‚Â Â â”‚Â Â â”œâ”€Â S3_URL.ts
â”‚Â Â â”‚Â Â â”œâ”€Â common.module.ts
â”‚Â Â â”‚Â Â â”œâ”€Â custom-exceptions
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â base-custom-exception.ts
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â policy-errors.ts
â”‚Â Â â”‚Â Â â”œâ”€Â global-exception.filter.ts
â”‚Â Â â”‚Â Â â”œâ”€Â swagger-mock-api.service.ts
â”‚Â Â â”‚Â Â â”œâ”€Â swagger-mock.interceptor.spec.ts
â”‚Â Â â”‚Â Â â””â”€Â swagger-mock.interceptor.ts
â”‚Â Â â”‚
â”‚Â Â â”œâ”€Â external-api
â”‚Â Â â”‚Â Â â”œâ”€Â dto
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â request-chatbot-reaction-from-conversation.dto.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â request-create-situation.dto.ts
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â request-feedback.dto.ts
â”‚Â Â â”‚Â Â â”œâ”€Â external-api.module.ts
â”‚Â Â â”‚Â Â â”œâ”€Â external-api.service.spec.ts
â”‚Â Â â”‚Â Â â””â”€Â external-api.service.ts
â”‚Â Â â”‚
â”‚Â Â â”œâ”€Â main.ts
â”‚Â Â â”‚
â”‚Â Â â”œâ”€Â messages
â”‚Â Â â”‚Â Â â”œâ”€Â domain
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â message-business-rule.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â message.cache-store.interface.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â message.repository.interface.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â message.type.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â messages.service.spec.ts
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â messages.service.ts
â”‚Â Â â”‚Â Â â”œâ”€Â infrastructure
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â message.cache-store.ts
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â message.repository.ts
â”‚Â Â â”‚Â Â â””â”€Â messages.module.ts
â”‚Â Â â”‚
â”‚Â Â â”œâ”€Â prisma
â”‚Â Â â”‚Â Â â”œâ”€Â prisma.module.ts
â”‚Â Â â”‚Â Â â””â”€Â prisma.service.ts
â”‚Â Â â”‚
â”‚Â Â â”œâ”€Â quizes
â”‚Â Â â”‚Â Â â”œâ”€Â domain
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â dto
â”‚Â Â â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â update-quiz.dto.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â quiz-list.type.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â quiz.cache-store.interface.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â quiz.repository.interface.ts
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â quizes.service.spec.ts
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â quizes.service.ts
â”‚Â Â â”‚Â Â â”œâ”€Â infrastructure
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â quiz.cache-store.ts
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â quiz.repository.ts
â”‚Â Â â”‚Â Â â””â”€Â quizes.module.ts
â”‚Â Â â”‚
â”‚Â Â â”œâ”€Â redis
â”‚Â Â â”‚Â Â â”œâ”€Â redis.module.ts
â”‚Â Â â”‚Â Â â”œâ”€Â redis.service-integration.test.ts
â”‚Â Â â”‚Â Â â”œâ”€Â redis.service.interface.ts
â”‚Â Â â”‚Â Â â””â”€Â redis.service.ts
â”‚Â Â â”‚
â”‚Â Â â””â”€Â users
â”‚Â Â Â Â Â â”œâ”€Â domain
â”‚Â Â Â Â Â â”‚Â Â â”œâ”€Â create-user.dto.ts
â”‚Â Â Â Â Â â”‚Â Â â”œâ”€Â user.policy.ts
â”‚Â Â Â Â Â â”‚Â Â â”œâ”€Â user.repository.interface.ts
â”‚Â Â Â Â Â â”‚Â Â â”œâ”€Â users.service.spec.ts
â”‚Â Â Â Â Â â”‚Â Â â””â”€Â users.service.ts
â”‚Â Â Â Â Â â”œâ”€Â infrastructure
â”‚Â Â Â Â Â â”‚Â Â â””â”€Â user.repository.ts
â”‚Â Â Â Â Â â”œâ”€Â presentation
â”‚Â Â Â Â Â â”‚Â Â â””â”€Â users.controller.ts
â”‚Â Â Â Â Â â””â”€Â users.module.ts
â”œâ”€Â test
â”‚Â Â â””â”€Â jest-e2e.json
â”œâ”€Â tsconfig.build.json
â”œâ”€Â tsconfig.json
â””â”€Â yarn.lock

```

---

## REST API ì •ì˜ì„œ

### ì±—ë´‡ëª©ë¡ ì¡°íšŒ

| Method | URL             | ëª©ì           |
| ------ | --------------- | ------------- |
| GET    | `/api/chatbots` | ì±—ë´‡ëª©ë¡ ì¡°íšŒ |

> ì˜ˆì‹œ ì‘ë‹µë°ì´í„°

```json
{
  "chatbots": [
    {
      "chatbot_id": 1,
      "chatbot_profile_image": "{S3-URL}/chatbots/1/profile.png",
      "chatbot_name": "íˆ¬ë‹¥ì´",
      "chatbot_personalities": "ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ì— ê°ì • 200% ëª°ì…",
      "chatbot_speciality": "ê³µê° ìŠ¤í‚¬ í–¥ìƒì„ ìœ„í•œ ì¡°ë ¥ ë©”ì´íŠ¸",
      "is_unknown": false
    },
    {
      "chatbot_id": 2,
      "chatbot_profile_image": "{S3-URL}/chatbots/2/unknown.png",
      "chatbot_name": "ì¸ê³ ìˆ˜_???",
      "chatbot_personalities": "???",
      "chatbot_speciality": "ì—°ì•  ê³µê° ì‹œë®¬ë ˆì´ì…˜",
      "is_unknown": true
    }
  ]
}
```

### ì±—ë´‡ ë§ˆì§€ë§‰ í¸ì§€ ì¡°íšŒ

| Method | URL                                                                     | ëª©ì                    |
| ------ | ----------------------------------------------------------------------- | ---------------------- |
| GET    | `/api/chatrooms/{chatroom_id}/letters`<br />- chatroom_id: uuid(string) | ì±—ë´‡ì˜ ë§ˆì§€ë§‰í¸ì§€ ì¡°íšŒ |

> ì˜ˆì‹œ ì‘ë‹µ ë°ì´í„°

```json
{
  "chatroom_id": "{uuid}",
  "is_finished": true,
  "current_distance": 10,
  "letter": "{íˆ¬ë‹¥ì´ê°€ ë³´ë‚´ëŠ” í¸ì§€ ë‚´ìš©}",
  "user_nickname": "ì‚¬ìš©ì ë‹‰ë„¤ì„",
  "chatbot_name": "íˆ¬ë‹¥ì´",
  "chatbot_id": 1,
  "from_chatbot": "í˜ë“¤ì—ˆë˜ í•˜ë£¨ ëì—, \n íˆ¬ë‹¥ì´"
  "letter_mp3": "{S3-URL}/chatrooms/results/{chatroom_id}/letter_voice.mp3",
  "chatbot_result_image": "{S3-URL}/chatbots/{chatbot_id}/results/result_0.png"
}
```

<br>

> ì„¤ëª…

| í•„ë“œëª…               | ë°ì´í„° íƒ€ì…  | ì •ì˜                                                          |
| -------------------- | ------------ | ------------------------------------------------------------- |
| chatroom_id          | string(uuid) | ì±„íŒ…ë°© PK                                                     |
| is_finished          | boolean      | í¸ì§€ì§€ì‘ì„± ì™„ë£Œ ì—¬ë¶€ - ì‘ì„±ì™„ë£Œ: true - ë¯¸ì™„ì„±(ì±„íŒ…ì¤‘): false |
| current_distance     | int          | ì±—ë´‡ê³¼ì˜ ì‚¬ì´ê±°ë¦¬                                             |
| letter               | string       | ë§ˆì§€ë§‰ í¸ì§€ ë‚´ìš©                                              |
| user_nickname        | string       | ì‚¬ìš©ì ë‹‰ë„¤ì„                                                 |
| chatbot_id           | int          | ì±—ë´‡ PK                                                       |
| chatbot_name         | string       | ì±—ë´‡ ì´ë¦„                                                     |
| letter_mp3           | string(url)  | ë§ˆì§€ë§‰ í¸ì§€ ë‚´ìš© ìŒì„±íŒŒì¼ url                                 |
| chatbot_result_image | string(url)  | ë§ˆì§€ë§‰ í¸ì§€ ê²°ê³¼ ì´ë¯¸ì§€ url                                   |
| from_chatbot         | string       | {AIì‘ì„± ë§ˆì§€ë§‰ ì•ˆë¶€ì¸ì‚¬},{ì±—ë´‡ëª…}                             |

<br>

> ì±—ë´‡ ê²°ê³¼ì´ë¯¸ì§€ íŒŒì¼(chatbot_result_image) ì¡°ê±´

| í•˜íŠ¸ê°œìˆ˜<br />heart_life | ì±—ë´‡ê³¼ì˜ ê±°ë¦¬<br />(current_distance) | ì±—ë´‡ê²°ê³¼ ì´ë¯¸ì§€íŒŒì¼<br />chatbot_result_image | ì„¤ëª…                          |
| :----------------------: | ------------------------------------- | --------------------------------------------- | ----------------------------- |
|            0             | 5                                     | result_0.png                                  | ì±—ë´‡ê³¼ ì‚¬ì´ê±°ë¦¬ê°€ ê°€ì¥ ë©€ë‹¤   |
|            1             | 4                                     | result_1.png                                  |                               |
|           2~3            | 3~2                                   | result_2.png                                  |                               |
|            4             | 1                                     | result_3.png                                  |                               |
|            5             | 0                                     | result_4.png                                  | ì±—ë´‡ê³¼ ì‚¬ì´ê±°ë¦¬ê°€ ê°€ì¥ ê°€ê¹ë‹¤ |

---

## Websocket ì´ë²¤íŠ¸ ì •ì˜ì„œ

### `join_room` ì´ë²¤íŠ¸

- í´ë¼ì´ì–¸íŠ¸(ì‚¬ìš©ì)ê°€ ì±„íŒ…ë°©ì— ì…ì¥í•˜ê²Œë˜ë©´ join_room ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤.
- ì„œë²„ì—ì„œëŠ” join_room ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ì—¬ ì‘ë‹µì„ í•©ë‹ˆë‹¤.

> Request
>
> - ì„¤ëª…

| í•„ë“œëª…        | ë°ì´í„° íƒ€ì… | ì •ì˜                              |
| ------------- | ----------- | --------------------------------- |
| user_nickname | string      | ì‚¬ìš©ì ë‹‰ë„¤ì„                     |
| chatbot_id    | int         | ì±—ë´‡ PK : ì‚¬ìš©ìê°€ ì„ íƒí•œ ì±—ë´‡ PK |

> - ì˜ˆì‹œ ìš”ì²­ ë°ì´í„°

```json
{
  "user_nickname": "ìœ ì € ë‹‰ë„¤ì„",
  "chatbot_id": 1
}
```

<br>

> Response
>
> - ì„¤ëª…

| í•„ë“œëª…           | ë°ì´í„° íƒ€ì…  | ì •ì˜                                            |
| ---------------- | ------------ | ----------------------------------------------- |
| chatroom_id      | string(uuid) | ì±„íŒ…ë°© PK                                       |
| user_id          | string(uuid) | ì‚¬ìš©ì PK                                       |
| user_nickname    | string       | ì‚¬ìš©ì ë‹‰ë„¤ì„                                   |
| chatbot_id       | int          | ì±—ë´‡ PK                                         |
| chatbot_name     | string       | ì±—ë´‡ ì´ë¦„                                       |
| current_distance | int          | ì±—ë´‡ê³¼ì˜ ê±°ë¦¬ <br />- ì±„íŒ… ì²« ì…ì¥ì‹œ ì´ˆê¸°ê°’: 10 |
| heart_life       | int          | ë¶„í™ í•˜íŠ¸ê°œìˆ˜ <br />- ì±„íŒ… ì²« ì…ì¥ì‹œ ì´ˆê¸°ê°’: 10 |
| sender_type      | string       | ì „ì†¡ì£¼ì²´ <br />- ì±—ë´‡: BOT<br />- ì‚¬ìš©ì: USER  |
| turn_count       | int          | ì•ìœ¼ë¡œ ì±—ë´‡ì˜ ëŒ€í™” ê°€ëŠ¥ íšŸìˆ˜                    |

> - ì˜ˆì‹œ ì‘ë‹µ ë°ì´í„°

```json
{
  "user_id": "{uuid}",
  "user_nickname": "ì‚¬ìš©ì ë‹‰ë„¤ì„",
  "chatbot_id": 1,
  "chatroom_id": "{uuid}",
  "chatbot_name": "íˆ¬ë‹¥ì´",
  "current_distance": 5,
  "heart_life": 5,
  "sender_type": "BOT",
  "message": "ì €ê¸°.. {user_nickname}..! ì˜ì§€ëƒˆì–´? í˜¹ì‹œ ë‚´ê°€ í• ë§ì´ ìˆëŠ”ë° ë“¤ì–´ì¤„ë˜?",
  "chatbot_profile_image": "{S3-URL}/chatbots/{chatbot_id}/profile.png",
  "turn_count": 5
}
```

### `answer` ì´ë²¤íŠ¸

- í´ë¼ì´ì–¸íŠ¸(ì‚¬ìš©ì)ëŠ” í€´ì¦ˆì— ëŒ€í•œ ë‹µë³€ì„ í•¨ìœ¼ë¡œì¨, answer ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤.
- ì„œë²„ì—ì„œëŠ” answer ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ì—¬ ì‘ë‹µì„ í•©ë‹ˆë‹¤.

> Request
>
> - ì„¤ëª…

| í•„ë“œëª…      | ë°ì´í„° íƒ€ì…  | ì •ì˜                                         |
| ----------- | ------------ | -------------------------------------------- |
| chatbot_id  | int          | ì±—ë´‡ PK                                      |
| message     | string       | ì‚¬ìš©ì ë©”ì‹œì§€ ì…ë ¥ë‚´ìš©                       |
| sender_type | string       | ì „ì†¡ ì£¼ì²´<br />- USER: ì‚¬ëŒ<br />- BOT: ì±—ë´‡ |
| chatroom_id | string(uuid) | ì±„íŒ…ë°© PK                                    |
| user_id     | string(uuid) | ì‚¬ìš©ì PK                                    |

> - ì˜ˆì‹œ ìš”ì²­ ë°ì´í„°

```json
{
  "chatbot_id": 1,
  "message": "í€´ì¦ˆ1 ì‚¬ìš©ì ëŒ€ë‹µ ë©”ì‹œì§€",
  "sender_type": "USER",
  "chatroom_id": "{uuid}",
  "user_id": "{uuid}"
}
```

> Response
>
> - ì„¤ëª…

| í•„ë“œëª…                | ë°ì´í„° íƒ€ì…  | ì •ì˜                                                                            |
| --------------------- | ------------ | ------------------------------------------------------------------------------- |
| current_distance      | int          | ì±—ë´‡ê³¼ì˜ ì‚¬ì´ê±°ë¦¬                                                               |
| heart_life            | int          | ë¶„í™ í•˜íŠ¸ê°œìˆ˜                                                                   |
| chatroom_id           | string(uuid) | ì±„íŒ…ë°© PK                                                                       |
| chatbot_name          | string       | ì±—ë´‡ ì´ë¦„                                                                       |
| chatbot_id            | int          | ì±—ë´‡ PK                                                                         |
| message               | string       | í€´ì¦ˆ1 ì‚¬ìš©ì ëŒ€ë‹µ ë¦¬ì•¡ì…˜ ë©”ì‹œì§€                                                 |
| score                 | int          | í€´ì¦ˆ1 ì‚¬ìš©ì ëŒ€ë‹µ í‰ê°€ ì ìˆ˜<br />- 1: ê¸ì •<br />- 0: ë¶€ì •                       |
| chatbot_profile_image | string(url)  | ì±—ë´‡ í”„ë¡œí•„ ì´ë¯¸ì§€ url                                                          |
| reaction_image        | string(url)  | ë¦¬ì•¡ì…˜ ì´ë¯¸ì§€<br />- score:1 ì¼ë•Œ positive.png<br />- score:0 ì¼ë•Œ negative.png |
| user_id               | string(uuid) | ìœ ì € PK                                                                         |
| turn_count            | Int          | ì•ìœ¼ë¡œ ì±—ë´‡ì˜ ëŒ€í™” ê°€ëŠ¥ íšŸìˆ˜                                                    |

> - ì˜ˆì‹œ ì‘ë‹µ ë°ì´í„°

```json
{
  "chatbot_id": 1,
  "chatbot_name": "íˆ¬ë‹¥ì´",
  "message": "í€´ì¦ˆ1 ë¦¬ì•¡ì…˜ ë©”ì‹œì§€",
  "user_id": "{uuid}",
  "sender_type": "BOT",
  "chatroom_id": "{uuid}",
  "score": 1,
  "chatbot_profile_image": "{S3-URL}/chatbots/{chatbot_id}/profile.png",
  "reaction_image": "{S3-URL}/chatbots/{chatbot_id}/reactions/positive.png",
  "heart_life": 10,
  "current_distance": 10,
  "turn_count": 0
}
```

<br>

- ë§ˆì§€ë§‰í€´ì¦ˆ(5ë²ˆì§¸)ì¼ ê²½ìš°ì—ëŠ” ì‚¬ìš©ìë‹µë³€ì— ëŒ€í•œ ë¦¬ì•¡ì…˜ì„ í•˜ì§€ ì•Šê³  ê³ ì •í…ìŠ¤íŠ¸ë©”ì‹œì§€ë¡œ ì‘ë‹µí›„ ì±„íŒ…ì„ ì¢…ë£Œí•˜ë„ë¡í•©ë‹ˆë‹¤.

> Request
>
> - ì˜ˆì‹œ ìš”ì²­ ë°ì´í„°

```json
{
  "chatbot_id": 1,
  "message": "í€´ì¦ˆ5 ì‚¬ìš©ì ëŒ€ë‹µ",
  "sender_type": "USER",
  "chatroom_id": "{uuid}",
  "user_id": "{uuid}"
}
```

> Response
>
> - ì˜ˆì‹œ ì‘ë‹µ ë°ì´í„°

```json
{
  "chatbot_id": 1,
  "chatbot_name": "íˆ¬ë‹¥ì´",
  "message": "ì˜¤ëŠ˜ ë„ˆë‘ ì–˜ê¸°í•´ì„œ ì •ë§ ì¦ê±°ì› ì–´. {user_nickname}! ì €ê¸°â€¦ ì‚¬ì‹¤ ë„ˆì—ê²Œ í•˜ê³  ì‹¶ì€ ë§ì´ ìˆì–´ì„œâ€¦í¸ì§€ë¡œ ì¨ë´¤ëŠ”ë°, í˜¹ì‹œ ë°›ì•„ì¤„ë˜?",
  "user_id": "{uuid}",
  "sender_type": "BOT",
  "chatroom_id": "{uuid}",
  "score": 1,
  "chatbot_profile_image": "{S3-URL}/chatbots/{chatbot_id}/profile.png",
  "heart_life": 5,
  "current_distance": 5,
  "turn_count": 0
}
```

### `quiz` ì´ë²¤íŠ¸

- í€´ì¦ˆì´ë²¤íŠ¸ëŠ” ì„œë²„ì—ì„œ ë°œí–‰í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸(ì‚¬ìš©ì)ì—ê²Œ ìš”ì²­ì„ í•©ë‹ˆë‹¤.
- ì‚¬ìš©ìëŠ” quiz ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•¨ìœ¼ë¡œì¨ ì±—ë´‡ìœ¼ë¡œ ë‹µë³€ì„ ë°›ì•˜ìŒì„ í™•ì¸í•˜ê¸° ìœ„í•œ ìš©ë„ì…ë‹ˆë‹¤.

### `policy_error` ì´ë²¤íŠ¸

- ì‚¬ìš©ì ë‹µë³€ì— ë¶€ì ì ˆí•œ í‚¤ì›Œë“œë‚˜ ë¹„ì†ì–´/í”„ë¡¬í”„íŠ¸ íƒˆì·¨/ ë¹„ì†ì–´ë¥¼ ë¶ˆëŸ¬ì¼ìœ¼í‚¤ëŠ” ê²½ìš°ì— ì´ë²¤íŠ¸ ë°œìƒí•©ë‹ˆë‹¤.
- ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ê²Œë˜ë©´ 'ë¶€ì ì ˆí•œ ë©”ì‹œì§€ê°€ ê°ì§€ë˜ì—ˆì–´ìš”' í† ìŠ¤íŠ¸ UIê°€ ë‚˜ì˜µë‹ˆë‹¤.

> Request

```json
{
  "chatbot_id": 1,
  "message": "í€´ì¦ˆ1 ì‚¬ìš©ì ëŒ€ë‹µ ë©”ì‹œì§€(ì •ì±…ìœ„ë°˜ í‚¤ì›Œë“œ ë° ë¬¸ë§¥ë³´ìœ )",
  "sender_type": "USER",
  "chatroom_id": "{uuid}",
  "user_id": "{uuid}"
}
```

> Response - policy_error ì´ë²¤íŠ¸ ë°œìƒ

```json
{
  "message": "ë¶€ì ì ˆí•œ ë©”ì‹œì§€ê°€ ê°ì§€ë˜ì—ˆì–´ìš”"
}
```

---

## í”„ë¡œì íŠ¸ ì…‹íŒ… ë°©ë²•

### í”„ë¡œì íŠ¸ ì´ˆê¸° ì…‹íŒ…

- Mysql8.0, Reids ë¨¼ì € ì„¤ì¹˜ ê¶Œì¥
- ë„ì»¤ì‹¤í–‰ì„ í•˜ê²Œë˜ë©´ ì•„ë˜ ëª…ë ¹ì–´ë¡œ ë¡œì»¬í™˜ê²½ ë„ì»¤ ì…‹íŒ…ì„ í•œë‹¤.

```bash
docker-compose up -d
```

- í”„ë¡œì íŠ¸ ì‚¬ìš© íŒ¨í‚¤ì§€ ì¸ìŠ¤í†¨

```bash
yarn install
```

- ì—°ê²°ëœ ë°ì´í„°ë² ì´ìŠ¤ì— prisma ORM ë°˜ì˜í•˜ê¸°

```bash
npx prisma generate
npx prisma db push
```

- ì´ˆê¸° ì±—ë´‡(íˆ¬ë‹¥ì´) ë°ì´í„° ì´ˆê¸°ì…‹íŒ…

```bash
npx prisma db seed
```

### í”„ë¡œì íŠ¸ ì‹¤í–‰

```bash
# ì¼ë°˜ ì‹¤í–‰
$ yarn run start

# ê°œë°œëª¨ë“œ
$ yarn run start:dev

```

### ë‹¨ìœ„í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰

```bash
# unit tests
$ yarn run test

```
